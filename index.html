<!doctype html>
<html prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <title>æ¸¬è©¦ç¶²é  </title>
    <link rel="icon" href="https://raw.githubusercontent.com/rushiaismywaifu/rushiaismywaifu.github.io/main/favicon.ico" type="image/x-icon">
    <meta property="og:title" content="Rushiaæˆ‘å©†">
    <meta property="og:description" content="é›–ç„¶å¥¹æ­»ã„Œ">
    <meta property="og:url" content="https://rushiaismywaifu.github.io">
    <meta property="og:image" content="https://raw.githubusercontent.com/rushiaismywaifu/rushiaismywaifu.github.io/main/image.png">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Rushia My Beloved">
    <style>
      /* ç°¡å–®å¢åŠ ä¸€é»æ¨£å¼è®“æ–°åŠŸèƒ½å¥½çœ‹ä¸€é» */
      .bili-shortener {
        border: 2px dashed #fb7299;
        padding: 15px;
        margin: 20px 0;
        background-color: #fff;
        border-radius: 8px;
      }
      .bili-shortener input[type="text"] {
        width: 60%;
        padding: 5px;
      }
      .bili-shortener button {
        background-color: #fb7299;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 4px;
      }
      .bili-shortener button:hover {
        background-color: #ff85ad;
      }
      #shortResult {
        font-weight: bold;
        color: #00a1d6;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <p>&nbsp;å—¨ï¼Œ <u><em><strong>test</strong></em></u>&nbsp; <s>Hello world!</s></p>
    <p style="text-align:center">x <sup>2</sup>+2x+1=0 </p>
    <p>å·¦é‚Š</p>
    <hr />
    
    <!-- æ–°å¢çš„åŠŸèƒ½å€å¡Šé–‹å§‹ -->
    <div class="bili-shortener">
      <h3>ğŸ“º Bilibili çŸ­ç¶²å€ç”Ÿæˆå™¨ (b23.tv)</h3>
      <p>è«‹è¼¸å…¥ Bç«™ ç¶²å€ (ä¾‹å¦‚: https://www.bilibili.com/opus/1170602437564694531)ï¼š</p>
      <input type="text" id="longUrl" placeholder="è²¼ä¸Šé•·ç¶²å€..." />
      <button onclick="generateShortLink()" id="genBtn">ç”ŸæˆçŸ­éˆ</button>
      <div id="shortResult"></div>
    </div>
    <!-- æ–°å¢çš„åŠŸèƒ½å€å¡ŠçµæŸ -->

    <p style="text-align:right">å³é‚Š</p>
    <p><input name="æˆ‘æ˜¯æŒ‰éˆ•" type="radio" value="YES" />YES </p>
    <p><input maxlength="10" name="æ–‡å­—" type="email" value="0" /></p>
    <a href="https://rushiaismywaifu.github.io/project-1" target="_blank">å¾€project-1</a><br />
    <a href="/PageTest" target="_blank">å¾€PageTest</a><br />
    <a href="/aboutme" target="_blank">å¾€aboutme</a><br />
    <a href="https://raw.githubusercontent.com/rushiaismywaifu/PageTest/gh-pages/ayame.mp3">ayame</a>
    <audio src="https://raw.githubusercontent.com/rushiaismywaifu/PageTest/gh-pages/ayame.mp3" controls></audio>
    <p><select multiple="true" name="æ¬„ä½">
        <option value="50">abc</option>
        <option value="0">def</option>
        <option value="-5">ghi</option>
      </select></p>
    <p><input name="æŒ‰éˆ•å—" type="button" value="20" /></p>
    <p><img alt="" src="https://raw.githubusercontent.com/rushiaismywaifu/rushiaismywaifu.github.io/main/d.png" style="float:left; height:1667px; width:2277px" /></p>
    <p style="text-align:right">&nbsp;</p>

    <!-- JavaScript é‚è¼¯ -->
    <script>
      async function generateShortLink() {
        const urlInput = document.getElementById('longUrl').value;
        const resultDiv = document.getElementById('shortResult');
        const btn = document.getElementById('genBtn');

        // ç°¡å–®é©—è­‰æ˜¯å¦ç‚º Bilibili ç¶²å€
        if (!urlInput.includes('bilibili.com')) {
          resultDiv.innerText = "âŒ è«‹è¼¸å…¥æœ‰æ•ˆçš„ Bilibili ç¶²å€ (éœ€åŒ…å« bilibili.com)";
          return;
        }

        btn.disabled = true;
        resultDiv.innerText = "â³ ç”Ÿæˆä¸­...";

        // æº–å‚™ API åƒæ•¸ (æ ¹æ“šæ‚¨æä¾›çš„ API æ–‡ä»¶)
        const params = new URLSearchParams();
        params.append('build', '6114514');
        params.append('buvid', 'qwq');
        params.append('oid', urlInput); // å°‡è¼¸å…¥çš„ç¶²å€ä½œç‚º oid
        params.append('platform', 'unix');
        params.append('share_channel', 'COPY');
        params.append('share_id', 'public.webview.0.0.pv'); // é‡å°é€šç”¨é€£çµçš„ share_id
        params.append('share_mode', '4');

        // å®šç¾© API ç«¯é»
        // ç”±æ–¼ GitHub Pages å¼·åˆ¶ HTTPSï¼Œæˆ‘å€‘å„ªå…ˆä½¿ç”¨å®˜æ–¹ HTTPS æ¥å£
        // ä¸¦åŠ ä¸Š corsproxy.io å˜—è©¦ç¹éç€è¦½å™¨çš„è·¨åŸŸé™åˆ¶
        const targetApi = 'https://api.bilibili.com/x/share/click';
        const proxyUrl = 'https://corsproxy.io/?' + encodeURIComponent(targetApi);

        try {
          const response = await fetch(proxyUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: params
          });

          if (!response.ok) {
            throw new Error(`ç¶²è·¯éŒ¯èª¤: ${response.status}`);
          }

          const json = await response.json();

          if (json.code === 0 && json.data && json.data.content) {
            // API å›å‚³çš„ content é€šå¸¸åŒ…å«æ¨™é¡Œå’Œé€£çµï¼Œä¾‹å¦‚ï¼š
            // "ã€æ¨™é¡Œ...ã€‘ https://b23.tv/xxxxx"
            // æˆ‘å€‘ä½¿ç”¨ Regex æå–å‡º https://b23.tv/xxxxx
            const content = json.data.content;
            const match = content.match(/https:\/\/b23\.tv\/[a-zA-Z0-9]+/);
            
            if (match) {
              const shortUrl = match[0];
              resultDiv.innerHTML = `âœ… æˆåŠŸï¼š<a href="${shortUrl}" target="_blank">${shortUrl}</a>`;
            } else {
              resultDiv.innerText = "âš ï¸ API å›å‚³æˆåŠŸï¼Œä½†ç„¡æ³•è§£æå‡ºçŸ­ç¶²å€ã€‚åŸå§‹å›å‚³ï¼š" + content;
            }
          } else {
            resultDiv.innerText = "âŒ ç”Ÿæˆå¤±æ•—ï¼ŒAPI è¨Šæ¯ï¼š" + (json.message || "æœªçŸ¥éŒ¯èª¤");
          }

        } catch (error) {
          console.error(error);
          resultDiv.innerText = "âŒ ç™¼ç”ŸéŒ¯èª¤ (å¯èƒ½æ˜¯è·¨åŸŸ CORS é˜»æ“‹)ï¼š" + error.message;
        } finally {
          btn.disabled = false;
        }
      }
    </script>
  </body>
</html>
