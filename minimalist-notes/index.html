<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>üìù Minimalist Notes</title>
    
    <!-- Meta -->
    <meta name="author" content="ChatGPT √ó Claude AI ü§ñ">
    <meta name="description" content="Ê•µÁ∞°ÊöóÈªëÁ≠ÜË®òÊú¨ ‚Äî Ëá™Âãï‰øùÂ≠ò ‚Ä¢ Ë∑®ÂàÜÈ†ÅÂêåÊ≠• ‚Ä¢ Èõ¢Á∑öÂèØÁî®">
    <meta name="keywords" content="notes, Á≠ÜË®ò, Ê•µÁ∞°, minimalist, dark theme, offline, PWA">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#111111">
    <meta name="color-scheme" content="dark">
    
    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Notes">
    <link rel="apple-touch-icon" href="./assets/icon-192.png">
    
    <!-- Open Graph -->
    <meta property="og:title" content="üìù Minimalist Notes">
    <meta property="og:description" content="Ê•µÁ∞°ÊöóÈªëÁ≠ÜË®òÊú¨ ‚Äî ‰Ω†ÁöÑÊÄùÁ∑íÂÄºÂæó‰∏ÄÂÄãÂÆâÈùúÁöÑËßíËêΩ">
    <meta property="og:type" content="website">
    <meta property="og:image" content="./assets/icon-512.png">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìù</text></svg>">
    
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #111;
            color: #f0f0f0;
        }
        
        #doc {
            width: 100%;
            height: 100%;
            border: none;
            padding: 1.5rem;
            padding-bottom: 3rem;
            font-size: 1.125rem;
            line-height: 1.7;
            background-color: #111;
            color: #f0f0f0;
            word-wrap: break-word;
            resize: none;
            font-family: 'SF Mono', Menlo, Consolas, Monaco, 'Liberation Mono', 
                         'Lucida Console', 'Courier New', monospace;
            caret-color: #6cf;
            -webkit-font-smoothing: antialiased;
        }
        
        #doc:focus { outline: none; }
        #doc::placeholder { color: #555; font-style: italic; }
        #doc::selection { background-color: #346; color: #fff; }
        
        /* Scrollbar */
        #doc::-webkit-scrollbar { width: 10px; }
        #doc::-webkit-scrollbar-track { background: #1a1a1a; }
        #doc::-webkit-scrollbar-thumb { 
            background: #333; 
            border-radius: 5px; 
            border: 2px solid #1a1a1a; 
        }
        #doc::-webkit-scrollbar-thumb:hover { background: #444; }
        #doc { scrollbar-width: thin; scrollbar-color: #333 #1a1a1a; }
        
        /* Status */
        #status {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 0.4rem 0.8rem;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            border-radius: 2rem;
            font-size: 0.75rem;
            font-family: system-ui, -apple-system, sans-serif;
            color: #888;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
        }
        
        #status.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @supports (padding: env(safe-area-inset-bottom)) {
            #doc { padding-bottom: calc(1.5rem + env(safe-area-inset-bottom)); }
            #status { bottom: calc(1rem + env(safe-area-inset-bottom)); }
        }
    </style>
</head>

<body>
    <textarea 
        id="doc" 
        autofocus
        spellcheck="false"
        autocomplete="off"
        autocorrect="off"
        autocapitalize="off"
        placeholder="ÈñãÂßãÊõ∏ÂØ´...

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

  ‚ú® Ëá™Âãï‰øùÂ≠òËá≥ÁÄèË¶ΩÂô®
  üîÑ Âç≥ÊôÇË∑®ÂàÜÈ†ÅÂêåÊ≠•
  üì¥ ÊîØÊè¥Èõ¢Á∑ö‰ΩøÁî®
  ‚å®Ô∏è Ctrl+S ÊâãÂãï‰øùÂ≠ò

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    ></textarea>
    
    <div id="status" aria-live="polite"></div>

    <script>
    (() => {
        'use strict';
        
        const CONFIG = Object.freeze({
            STORAGE_KEY_DOC: 'notes-content-v2',
            STORAGE_KEY_TIME: 'notes-timestamp-v2',
            DEBOUNCE_DELAY: 150,
            STATUS_DISPLAY_TIME: 2000,
            SYNC_INTERVAL: 2000
        });
        
        const doc = document.getElementById('doc');
        const status = document.getElementById('status');
        
        let lastSaveTime = 0;
        let statusTimeoutId = null;
        
        // Storage
        const storage = {
            isAvailable: (() => {
                try {
                    const test = '__test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch { return false; }
            })(),
            
            get(key) {
                try { return localStorage.getItem(key); } 
                catch { return null; }
            },
            
            set(key, value) {
                try { 
                    localStorage.setItem(key, value); 
                    return true; 
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        showStatus('‚ö†Ô∏è ÂÑ≤Â≠òÁ©∫ÈñìÂ∑≤Êªø', 3000);
                    }
                    return false;
                }
            }
        };
        
        // UI
        function showStatus(message, duration = CONFIG.STATUS_DISPLAY_TIME) {
            status.textContent = message;
            status.classList.add('show');
            clearTimeout(statusTimeoutId);
            statusTimeoutId = setTimeout(() => status.classList.remove('show'), duration);
        }
        
        function debounce(fn, delay) {
            let id;
            return (...args) => { clearTimeout(id); id = setTimeout(() => fn(...args), delay); };
        }
        
        // Core
        function loadContent() {
            const content = storage.get(CONFIG.STORAGE_KEY_DOC);
            const time = storage.get(CONFIG.STORAGE_KEY_TIME);
            lastSaveTime = time ? Number(time) : 0;
            if (content !== null) doc.value = content;
        }
        
        function saveContent(notify = true) {
            const now = Date.now();
            if (storage.set(CONFIG.STORAGE_KEY_DOC, doc.value) &&
                storage.set(CONFIG.STORAGE_KEY_TIME, now.toString())) {
                lastSaveTime = now;
                if (notify) showStatus('‚úì Â∑≤‰øùÂ≠ò');
                return true;
            }
            return false;
        }
        
        const debouncedSave = debounce(() => saveContent(true), CONFIG.DEBOUNCE_DELAY);
        
        function syncFromStorage() {
            const storedTime = Number(storage.get(CONFIG.STORAGE_KEY_TIME)) || 0;
            if (storedTime > lastSaveTime) {
                const content = storage.get(CONFIG.STORAGE_KEY_DOC);
                if (content !== null && content !== doc.value) {
                    const pos = doc.selectionStart;
                    doc.value = content;
                    lastSaveTime = storedTime;
                    doc.setSelectionRange(
                        Math.min(pos, content.length), 
                        Math.min(pos, content.length)
                    );
                    showStatus('üîÑ Â∑≤ÂêåÊ≠•');
                }
            }
        }
        
        // Events
        function setupEvents() {
            doc.addEventListener('input', debouncedSave);
            
            window.addEventListener('storage', (e) => {
                if (e.key === CONFIG.STORAGE_KEY_DOC && e.newValue !== doc.value) {
                    doc.value = e.newValue || '';
                    lastSaveTime = Date.now();
                    showStatus('üîÑ Â∑≤ÂêåÊ≠•');
                }
            });
            
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') syncFromStorage();
            });
            
            window.addEventListener('beforeunload', () => saveContent(false));
            
            doc.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveContent(true);
                    showStatus('üíæ Â∑≤‰øùÂ≠ò');
                }
            });
        }
        
        // Service Worker
        function registerSW() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(() => console.log('‚úÖ SW registered'))
                    .catch(() => console.log('‚ÑπÔ∏è SW not available'));
            }
        }
        
        // Init
        function init() {
            if (!storage.isAvailable) {
                alert('‚ö†Ô∏è ÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Êú¨Âú∞ÂÑ≤Â≠òÔºåÁ≠ÜË®òÂ∞áÁÑ°Ê≥ï‰øùÂ≠ò„ÄÇ');
                return;
            }
            loadContent();
            setupEvents();
            registerSW();
            setInterval(syncFromStorage, CONFIG.SYNC_INTERVAL);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>
</body>
</html>